# Exchange.out Format

The `exchange.out` file is a human-readable text file that summarizes the calculated magnetic interaction parameters. It is typically located in the `TB2J_results` directory.

## File Sections

The file is divided into three main sections:

### 1. Information Section
Contains metadata about the calculation, including the version of TB2J used and the generation time.
```
==========================================================================================
Information: 
Input from collinear LaWaF data.
Tight binding data from ./ .
...
```

### 2. Cell and Atoms Section
Describes the crystal structure and atomic properties.

*   **Cell**: The lattice vectors in Angstroms.
*   **Atoms**: Table listing each atom in the unit cell.
    *   **Atom number**: Index of the atom.
    *   **x, y, z**: Cartesian coordinates in Angstroms.
    *   **w_charge**: Electronic charge from Wannier functions.
    *   **w_magmom**: Magnetic moment from Wannier functions.
    *   **M(x), M(y), M(z)**: Magnetic moment components (for non-collinear calculations).

*Note: The charge and magnetic moments listed here only account for the contribution from the Wannier functions used in the model, not necessarily the full DFT charge/moment.*

```
==========================================================================================
Cell (Angstrom):
7.00000000  0.00000000  0.00000000
0.00000000  7.00000000  0.00000000
0.00000000  0.00000000  7.00000000

==========================================================================================
Atoms:  
(Note: charge and magmoms only count the wannier functions.)
 Atom number        x             y             z        w_charge  w_magmom
Fe1              0.00000000    0.00000000    0.00000000    8.0000    2.2000
...
Total                                                     16.0000    4.4000
```

### 3. Exchange Parameters Section
Lists the calculated magnetic interactions between pairs of atoms. The convention for the Hamiltonian is:
$H = - \sum_{i<j} J_{ij} \mathbf{S}_i \cdot \mathbf{S}_j$

*   **i, j**: Indices of the interacting atoms.
*   **R**: Lattice vector index (n1, n2, n3) pointing to the cell of atom j relative to atom i.
*   **J_iso(meV)**: Isotropic exchange coupling constant in meV. Positive J indicates ferromagnetic coupling, negative J indicates antiferromagnetic coupling.
*   **vector**: The vector connecting atom i to atom j in Angstroms.
*   **distance(A)**: Distance between atom i and atom j in Angstroms.

```
==========================================================================================
Exchange: 
    i      j              R             J_iso(meV)          vector           distance(A) 
----------------------------------------------------------------------------------------
   Fe1    Fe2  (  0,   0,   0)  10.5000   ( 2.500,  2.500,  2.500)  4.330 
J_iso: 10.5000 
[Testing!] DMI: ( 0.1000  -0.2000   0.0000)
[Testing!]J_ani:
[[ 0.1  0.0  0.0]
 [ 0.0  0.2  0.0]
 [ 0.0  0.0 -0.3]]
```

For non-collinear or spin-orbit coupling calculations, additional terms may appear:
*   **DMI**: Dzyaloshinskii-Moriya Interaction vector ($D_{ij}$). $E_{DMI} = \mathbf{D}_{ij} \cdot (\mathbf{S}_i \times \mathbf{S}_j)$
*   **J_ani**: Anisotropic exchange tensor.

## Conversion Note
The values in `exchange.out` follow the Heisenberg Hamiltonian convention mentioned above. Some other codes (like Vampire) might use a different convention (e.g., summation over all pairs without $i<j$ restriction, or including a factor of 1/2). TB2J automatically handles these conversions when generating input files for those specific codes (e.g. in the `Vampire/` or `Multibinit/` subdirectories). Specifically, for the "tensorial" format used in `TB2J-Vampire` interface, the values are 2 times those in `exchange.out`.

# Magnon Band Structure Plotting

The `TB2J_magnon.py` script calculates and plots the magnon band structure (spin wave dispersion) based on the exchange parameters calculated by TB2J.

## Usage
```bash
TB2J_magnon.py [options]
```

## Description
This tool reads the `exchange.xml` file generated by the main TB2J calculation and diagonalizes the magnetic Hamiltonian in reciprocal space to obtain magnon frequencies. It then plots these frequencies along a specified path in the Brillouin zone.

## Key Options

| Option | Description |
| :--- | :--- |
| `--fname` | Path to the exchange XML file (default: `exchange.xml`). |
| `--qpath` | The path in the Brillouin zone (e.g., `G M K G`). If not provided, it attempts to automatically select a standard high-symmetry path based on the crystal structure using ASE. |
| `--figfname` | Filename to save the plot (e.g., `magnon.png`, `bands.pdf`). |
| `--show` | Display the plot interactively window (requires a display environment). |
| `--Jq` | Plot the eigenvalues of the Fourier transform of J, $J(\mathbf{q})$, instead of the magnon frequencies $\omega(\mathbf{q})$. |
| `--no_Jiso` | Ignore isotropic exchange ($J_{iso}$) in the calculation. |
| `--no_dmi` | Ignore Dzyaloshinskii-Moriya Interaction (DMI). |
| `--no_Jani` | Ignore anisotropic symmetric exchange ($J_{ani}$). |
| `--write_emin` | Write the energy minimum info to stdout. |

## Example
```bash
# Basic plot, showing the window
TB2J_magnon.py --fname TB2J_results/exchange.xml --show

# Save to file, specifying a custom path (Gamma -> M -> K -> Gamma)
TB2J_magnon.py --fname TB2J_results/exchange.xml --qpath "G M K G" --figfname magnon_bands.pdf
```
